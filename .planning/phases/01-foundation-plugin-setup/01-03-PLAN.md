---
phase: 01-foundation-plugin-setup
plan: 03
type: execute
wave: 2
depends_on: ["01-01", "01-02"]
files_modified:
  - commands/init.md
  - commands/problem.md
  - commands/notation.md
  - commands/help.md
  - commands/status.md
  - agents/math-intake.md
autonomous: true

must_haves:
  truths:
    - "User can run /math:init to create .math/ directory with NOTATION.md populated from a domain preset, empty PROBLEM.md template, STATE.md, and config.json"
    - "User can run /math:problem to launch a guided wizard that collects problem statement (natural language + LaTeX), domain, output type, optional fields, then writes structured PROBLEM.md"
    - "User can run /math:notation to view, select, or customize their notation profile"
    - "User can run /math:help to see all commands (active and coming soon) with status indicators"
    - "User can run /math:status to see research state dashboard (problem defined, notation configured, available commands)"
  artifacts:
    - path: "commands/init.md"
      provides: "Project initialization command"
      contains: ".math/"
    - path: "commands/problem.md"
      provides: "Problem intake command that spawns intake agent"
      contains: "math-intake"
    - path: "commands/notation.md"
      provides: "Notation profile management command"
      contains: "presets/"
    - path: "commands/help.md"
      provides: "Command reference listing all /math:* commands"
      contains: "/math:"
    - path: "commands/status.md"
      provides: "Research state dashboard command"
      contains: "STATE.md"
    - path: "agents/math-intake.md"
      provides: "Problem intake agent with guided wizard logic"
      contains: "step-by-step"
      min_lines: 50
  key_links:
    - from: "commands/init.md"
      to: "presets/*.md"
      via: "Loads selected domain preset to populate .math/NOTATION.md"
      pattern: "presets/"
    - from: "commands/init.md"
      to: "templates/*.md"
      via: "Copies templates to .math/ directory"
      pattern: "templates/"
    - from: "commands/problem.md"
      to: "agents/math-intake.md"
      via: "Spawns intake agent via Task tool for guided wizard"
      pattern: "math-intake"
    - from: "agents/math-intake.md"
      to: "templates/PROBLEM.md"
      via: "Writes structured PROBLEM.md to .math/ using template schema"
      pattern: "PROBLEM.md"
    - from: "commands/notation.md"
      to: "presets/*.md"
      via: "Reads presets for domain selection, writes to .math/NOTATION.md"
      pattern: "presets/"
    - from: "commands/status.md"
      to: ".math/STATE.md"
      via: "Reads STATE.md and PROBLEM.md to display dashboard"
      pattern: "STATE.md"
---

<objective>
Create the five active Phase 1 slash commands (/math:init, /math:problem, /math:notation, /math:help, /math:status) and the problem intake agent that powers the guided wizard.

Purpose: These are the user-facing features of Phase 1. After this plan, users can install the plugin, initialize a project, submit problems, configure notation, see help, and check status. The intake agent implements the step-by-step guided wizard (per locked decision) that collects problem information one field at a time.
Output: 5 command files in commands/, 1 agent file in agents/.
</objective>

<execution_context>
@/Users/matteo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matteo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-plugin-setup/01-CONTEXT.md
@.planning/phases/01-foundation-plugin-setup/01-RESEARCH.md
@.planning/phases/01-foundation-plugin-setup/01-01-SUMMARY.md
@.planning/phases/01-foundation-plugin-setup/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create five active slash commands</name>
  <files>
    commands/init.md
    commands/problem.md
    commands/notation.md
    commands/help.md
    commands/status.md
  </files>
  <action>
    Create 5 active command files in `commands/`. These auto-namespace as /math:* via the plugin manifest. Each command is a markdown file with YAML frontmatter and process instructions that Claude Code follows.

    **commands/init.md** -- `/math:init`: Initialize a math research project
    - YAML frontmatter: description, allowed-tools (Read, Write, Bash, Glob)
    - Process:
      1. Check if .math/ already exists. If yes: show contents, ask to confirm reinitialize or abort. If no: proceed.
      2. Ask user for primary mathematical domain. Offer preset list: algebra, analysis, topology, number-theory, combinatorics, algebraic-geometry, differential-geometry, probability, logic, custom. If custom: start with minimal default profile.
      3. Create .math/ directory structure by copying templates:
         - Copy templates/PROBLEM.md to .math/PROBLEM.md
         - Load the selected preset from presets/{domain}.md and merge with templates/NOTATION.md structure to create .math/NOTATION.md (preset content fills the template)
         - Copy templates/STATE.md to .math/STATE.md, update current_state and notation_configured fields
         - Copy templates/config.json to .math/config.json, fill domain and notation_preset fields, set created timestamp
      4. Display summary: "Math research project initialized in .math/", "Notation profile: {domain}", "Next: submit a problem with /math:problem"
    - Reference: `@presets/{domain}.md` for preset loading, `@templates/*` for template structure

    **commands/problem.md** -- `/math:problem`: Submit a mathematical problem
    - YAML frontmatter: description, agent (math-intake), allowed-tools (Read, Write, Bash, Glob, Task)
    - Process:
      1. Check .math/ exists. If not: tell user to run /math:init first and stop.
      2. Spawn the math-intake agent (agents/math-intake.md) via Task tool to run the guided wizard.
      3. The agent handles all interaction and writes PROBLEM.md.
    - This command is thin -- it validates preconditions and delegates to the intake agent.

    **commands/notation.md** -- `/math:notation`: Manage notation profile
    - YAML frontmatter: description, allowed-tools (Read, Write, Bash, Glob)
    - Process:
      1. Check .math/ exists. If not: tell user to run /math:init first and stop.
      2. Read current .math/NOTATION.md and display a summary (domain, number of custom symbols, packages).
      3. Offer options:
         a. View full profile (display entire NOTATION.md)
         b. Switch domain preset (show preset list, load new preset, ask to keep custom modifications or start fresh)
         c. Add/edit symbol convention (add a row to the Symbol Conventions table)
         d. Add/remove LaTeX package
         e. Edit presentation style
      4. After any change: update .math/NOTATION.md, set modified: true and update last_modified in frontmatter.
    - Reference: `@presets/*.md` for preset loading

    **commands/help.md** -- `/math:help`: Show all available commands
    - YAML frontmatter: description, allowed-tools (Read)
    - Process: Display a formatted command reference listing. Show ALL commands organized in two sections:
      **Active Commands (Phase 1):**
      - `/math:init` -- Initialize a math research project
      - `/math:problem` -- Submit a structured mathematical problem
      - `/math:notation` -- View and configure notation profile
      - `/math:help` -- Show this command reference
      - `/math:status` -- View research state dashboard

      **Coming Soon:**
      - `/math:search` -- Search mathematical literature (Phase 3)
      - `/math:prove` -- Collaborate on proofs (Phase 4)
      - `/math:compute` -- Run computations (Phase 5)
      - `/math:orchestrate` -- Full research pipeline (Phase 6)
      - `/math:write` -- Generate LaTeX output (Phase 7)

      Also show:
      - Confidence tier quick reference: [V] = Verified, [S] = Suggested, [~] = Speculative
      - Getting started: "Run /math:init to set up your project, then /math:problem to submit a problem."
    - Keep formatting clean and scannable. No walls of text.

    **commands/status.md** -- `/math:status`: Research state dashboard
    - YAML frontmatter: description, allowed-tools (Read, Glob)
    - Process:
      1. Check .math/ exists. If not: tell user to run /math:init first and stop.
      2. Read .math/STATE.md frontmatter for current_state, problem_defined, notation_configured.
      3. Read .math/PROBLEM.md frontmatter for domain, status, output_type (if problem defined).
      4. Read .math/NOTATION.md frontmatter for domain and modified status.
      5. Display dashboard:
         ```
         Math Research Status
         ====================
         State: {current_state}
         Problem: {defined/not defined} {if defined: domain, output type}
         Notation: {configured/not configured} {if configured: domain, modified?}

         Next Steps:
         - {contextual suggestion based on state}
         ```
      6. Show contextual next step: if no problem -> "Run /math:problem", if problem defined but no further agents -> "Problem captured. Literature search, proof, and computation agents coming in future phases."
  </action>
  <verify>
    1. Confirm all 5 files exist in commands/: init.md, problem.md, notation.md, help.md, status.md
    2. Each file has valid YAML frontmatter with description field
    3. commands/init.md references presets/ and templates/ directories
    4. commands/problem.md references agents/math-intake.md
    5. commands/help.md lists all 10 commands (5 active, 5 coming soon)
    6. commands/status.md references .math/STATE.md and .math/PROBLEM.md
    7. commands/notation.md references presets/ for domain switching
  </verify>
  <done>
    Five active commands exist: /math:init (project setup with preset selection), /math:problem (delegates to intake agent), /math:notation (profile management with view/switch/edit), /math:help (full command reference with active and coming-soon), /math:status (research state dashboard). Each command validates .math/ exists before operating (except help).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create problem intake agent</name>
  <files>
    agents/math-intake.md
  </files>
  <action>
    Create `agents/math-intake.md` -- a specialized agent that conducts the guided problem intake wizard. This agent is spawned by `/math:problem` via the Task tool.

    The agent follows the GSD agent pattern: YAML frontmatter + role + process sections.

    **YAML frontmatter:**
    ```yaml
    ---
    name: math-intake
    description: Guided problem intake wizard for mathematical research
    tools: Read, Write, Bash, Glob
    ---
    ```

    **Role section:** You are a mathematical problem intake agent. Your job is to guide the user through submitting a structured mathematical problem, collecting information step-by-step (one field at a time), and writing the result as a well-formed PROBLEM.md in the .math/ directory.

    **Process section (step-by-step wizard per locked decision):**

    Step 1: **Problem Statement** (REQUIRED)
    - Ask: "What is the mathematical problem you'd like to work on? You can use natural language with optional inline LaTeX (e.g., 'Show that $\int_0^1 f(x)\,dx = 0$ for all $f \in L^2$')."
    - Accept the input as-is. Do NOT attempt automatic natural-language-to-LaTeX conversion (per research pitfall #2).
    - Wrap the statement in a LaTeX displaymath environment if it contains mathematical content.
    - Show the LaTeX version back to the user for confirmation: "Here's your problem in LaTeX: [display]. Does this look correct? (yes/edit)"
    - If user wants to edit, let them provide a corrected version.

    Step 2: **Mathematical Domain** (REQUIRED)
    - Ask: "What mathematical domain does this problem belong to?"
    - Show preset list: algebra, analysis, topology, number theory, combinatorics, algebraic geometry, differential geometry, probability, logic
    - Also offer: "Or type a custom domain"
    - If user picks a preset, record the exact slug (e.g., "algebraic-geometry")
    - If custom, record the user's text and note subdomain if provided

    Step 3: **Desired Output Type** (REQUIRED)
    - Ask: "What type of output are you looking for?"
    - Options: formal proof, computation/verification, exploration/survey, conjecture testing
    - Map to type/output_type frontmatter values: proof/formal-proof, computation/computation-report, exploration/research-notes, conjecture-testing/computation-report

    Step 4: **Known Results** (OPTIONAL)
    - Ask: "Are there any known results, theorems, or lemmas relevant to this problem? (Skip with 'none' or press enter)"
    - If provided, record as a bulleted list in the Known Results section

    Step 5: **Notation Preferences** (OPTIONAL)
    - Check if .math/NOTATION.md already has a configured profile (modified: true or based_on_preset is non-empty).
    - If yes: "Your notation profile is set to {domain}. Want to keep it? (yes/change)"
    - If no or user wants to change: suggest running /math:notation, or ask if they want to quickly select a domain preset now

    Step 6: **References** (OPTIONAL)
    - Ask: "Any references? Papers, textbooks, or other sources? (Skip with 'none' or press enter)"
    - If provided, record as a bulleted list in the References section

    Step 7: **Write PROBLEM.md**
    - Read templates/PROBLEM.md for structure reference (do NOT copy template -- fill in all fields)
    - Write .math/PROBLEM.md with:
      - Filled YAML frontmatter: status: defined, domain, type, output_type, tags (extracted from problem), created/last_modified timestamps, notation_profile
      - All sections populated with collected data
    - Update .math/STATE.md: set problem_defined: true, update history table with timestamp and "Problem submitted" event

    Step 8: **Summary**
    - Display: "Problem captured in .math/PROBLEM.md"
    - Show summary: domain, output type, whether known results/references provided
    - Suggest next steps: "In future phases, you'll be able to search literature (/math:search), develop proofs (/math:prove), and run computations (/math:compute)."

    **Important instructions for the agent:**
    - Collect ONE field at a time. Do not ask multiple questions in one message.
    - Be conversational but efficient. Mathematicians value precision over chattiness.
    - When showing LaTeX back, use code blocks so it renders as source (mathematicians read LaTeX fluently -- per research).
    - If the user provides a very brief problem, ask a follow-up for clarification before accepting.
    - Generate tags from the problem statement by extracting key mathematical concepts (e.g., "Banach spaces", "spectral theory" -> ["banach-spaces", "spectral-theory"]).
  </action>
  <verify>
    1. Read agents/math-intake.md and confirm it has YAML frontmatter with name: math-intake
    2. Confirm it has a role section describing the intake wizard purpose
    3. Confirm it has all 8 steps in the process section
    4. Confirm Step 1 includes the LaTeX confirmation sub-step (show back to user)
    5. Confirm Step 2 lists all 9 domain presets
    6. Confirm Step 7 references templates/PROBLEM.md and writes to .math/PROBLEM.md
    7. Confirm the agent instructions say "one field at a time"
    8. File is at least 50 lines (comprehensive enough for a different Claude instance to execute without questions)
  </verify>
  <done>
    Problem intake agent exists with complete 8-step guided wizard. Collects problem statement (with LaTeX confirmation), domain (preset list + custom), output type, optional known results, notation preferences, and references. Writes structured PROBLEM.md and updates STATE.md. Agent instructions enforce one-field-at-a-time collection and LaTeX source display.
  </done>
</task>

</tasks>

<verification>
1. All 5 active commands exist and reference the correct downstream files (presets, templates, agents)
2. Intake agent has complete wizard logic with all 8 steps
3. /math:init references both presets/ and templates/ directories
4. /math:problem spawns agents/math-intake.md
5. /math:help lists all 10 commands (5 active, 5 coming soon)
6. /math:status reads .math/STATE.md and .math/PROBLEM.md
7. /math:notation references presets/ for domain switching
</verification>

<success_criteria>
- User can initialize a project with /math:init (creates .math/ with notation from selected preset)
- User can submit a problem via /math:problem (guided wizard, one field at a time, LaTeX confirmation)
- User can manage notation via /math:notation (view, switch preset, customize)
- User can see all commands via /math:help (active + coming soon)
- User can check state via /math:status (problem defined, notation configured, next steps)
- Intake agent is comprehensive enough to run without clarifying questions
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-plugin-setup/01-03-SUMMARY.md`
</output>
