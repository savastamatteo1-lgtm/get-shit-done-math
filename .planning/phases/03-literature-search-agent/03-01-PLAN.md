---
phase: 03-literature-search-agent
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - protocols/literature-protocol.md
  - templates/LITERATURE.md
autonomous: true

must_haves:
  truths:
    - "A shared protocol defines the two-phase search-then-verify workflow that all literature operations follow"
    - "A LITERATURE.md template exists for each problem directory with YAML frontmatter, confirmed/unconfirmed sections, search history, and synthesis"
    - "Domain-to-arXiv-category mapping is defined so search queries target the correct mathematical categories"
    - "API reference information for arXiv and Semantic Scholar is codified in the protocol, not left to agent memory"
  artifacts:
    - path: "protocols/literature-protocol.md"
      provides: "Verification workflow, search strategy, LITERATURE.md schema, domain-to-category mapping, API reference, anti-hallucination rules"
      contains: "Phase A"
    - path: "templates/LITERATURE.md"
      provides: "Document template for .math/problems/{slug}/LITERATURE.md"
      contains: "Confirmed References"
  key_links:
    - from: "protocols/literature-protocol.md"
      to: "protocols/confidence-tiers.md"
      via: "confidence tier references [V]/[S]/[~] in paper entries and synthesis"
      pattern: "\\[V\\]|\\[S\\]|\\[~\\]"
    - from: "protocols/literature-protocol.md"
      to: "protocols/journal-protocol.md"
      via: "LIT- category journal entries with strategy taxonomy types broad-survey and targeted-search"
      pattern: "LIT-|broad-survey|targeted-search"
    - from: "templates/LITERATURE.md"
      to: "protocols/literature-protocol.md"
      via: "template structure matches the schema defined in the protocol"
      pattern: "Confirmed References|Unconfirmed References|Search History|Synthesis"
---

<objective>
Create the literature protocol and LITERATURE.md template that define the rules, schemas, and workflows for the literature search agent.

Purpose: The literature-search agent (Plan 03-02) needs a protocol defining the two-phase search-then-verify workflow, the LITERATURE.md document schema, domain-to-arXiv-category mappings, API endpoint references, and anti-hallucination rules. The template provides the initial document structure for each problem. Without these, the agent has no specification to follow.

Output: `protocols/literature-protocol.md` and `templates/LITERATURE.md`
</objective>

<execution_context>
@/Users/matteo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matteo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-literature-search-agent/03-RESEARCH.md

@protocols/confidence-tiers.md
@protocols/journal-protocol.md
@templates/PROBLEM.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create literature protocol</name>
  <files>protocols/literature-protocol.md</files>
  <action>
Create `protocols/literature-protocol.md` -- the single source of truth for how the literature search agent operates. This protocol is referenced by the agent (03-02) and defines all rules it must follow.

**Structure the protocol with these sections:**

**1. Purpose & Scope**
- This protocol governs all literature search operations in the math plugin
- Referenced by: literature-search agent, session-manager (LIT- entries), downstream agents (proof, writing) that consume LITERATURE.md

**2. Two-Phase Search Workflow**
Define the Phase A (Discovery) and Phase B (Verification) workflow from 03-RESEARCH.md Pattern 1:

- **Phase A: Discovery** -- Query arXiv and Semantic Scholar with multiple targeted queries derived from PROBLEM.md. Generate 3-5 queries per API from: (1) direct problem keywords, (2) domain + mathematical concepts from tags, (3) known results/theorems mentioned, (4) author/reference-based from references section, (5) related category browse via domain mapping. Collect candidate papers with metadata.

- **Phase B: Verification** -- For each candidate paper, fetch it individually by identifier from the source API. arXiv: use `id_list` parameter to batch-verify. Semantic Scholar: use individual paper lookup by ARXIV:{id} or DOI:{doi}. Compare returned metadata against discovery result. Mark CONFIRMED or UNCONFIRMED. Only CONFIRMED references enter the main results section.

- **Phase C: Synthesis** -- After verification, synthesize connections between confirmed papers and the user's problem. Identify specific theorems, techniques, and results that apply. Use confidence tier markers: [V] for verified theorem connections, [S] for agent-derived connections, [~] for speculative connections. Structure as: Applicable Theorems, Technique Connections, Gaps in Literature, Suggested Reading Order.

**3. Anti-Hallucination Rules (LIT-04)**
This is the most critical section. Rules:
- NEVER include papers from training data that cannot be verified via the API
- Every reference in LITERATURE.md MUST have a `Verified:` timestamp
- No reference enters "Confirmed References" without successful API verification
- If agent "believes" a paper exists but cannot fetch it, place in "Unconfirmed References" with explanation
- Unconfirmed references are clearly labeled and NEVER presented as established citations
- Verification entry must include the API endpoint URL used

**4. LITERATURE.md Document Schema**
Define the exact schema from 03-RESEARCH.md Pattern 3:
- YAML frontmatter fields: problem, total_papers, last_search, sources_queried, confirmed_count, unconfirmed_count
- Section structure: Search History table, Confirmed References, Synthesis, Unconfirmed References
- Individual paper entry format with: REF-NNN prefix, Title, Authors, Year, Source, arXiv ID, DOI, Abstract, Relevance, Key Results, Confidence tier, Verified timestamp
- Unconfirmed entry format: same fields but with Reason for non-confirmation instead of Verified timestamp

**5. Domain-to-arXiv-Category Mapping**
Include the full mapping table from 03-RESEARCH.md Pattern 2:
- algebra -> math.RA, math.GR, math.AC (secondary: math.RT, math.CT)
- analysis -> math.FA, math.CA, math.CV (secondary: math.AP, math.SP, math.OA)
- topology -> math.AT, math.GN, math.GT (secondary: math.DG, math.KT)
- number-theory -> math.NT (secondary: math.AG, math.CO)
- combinatorics -> math.CO (secondary: math.PR, math.RT)
- algebraic-geometry -> math.AG (secondary: math.AC, math.CT, math.KT)
- differential-geometry -> math.DG (secondary: math.AP, math.SG, math.MG)
- probability -> math.PR (secondary: math.FA, math.ST, math.DS)
- logic -> math.LO (secondary: math.CT, math.GN)

**6. API Reference**
Codify the API details so the agent does not rely on training data:

arXiv API:
- Base URL: `http://export.arxiv.org/api/query`
- Query parameter: `search_query` with field prefixes (ti:, au:, abs:, cat:, all:) and Boolean operators (AND, OR, ANDNOT)
- Batch verification: `id_list` parameter (comma-separated arXiv IDs)
- Pagination: `start`, `max_results` (default 10, max 2000)
- Sort: `sortBy=relevance` (default), `sortOrder=descending`
- Response: Atom 1.0 XML
- Rate limit: 3-second delay between calls recommended
- Key XML elements: `<title>`, `<author><name>`, `<summary>`, `<id>` (URL containing arXiv ID), `<arxiv:primary_category term="">`, `<published>`, `<arxiv:doi>`

Semantic Scholar API:
- Base URL: `https://api.semanticscholar.org/graph/v1`
- Paper search: `GET /paper/search?query={terms}&fields={fields}&limit={n}&fieldsOfStudy=Mathematics`
- Paper lookup: `GET /paper/{id}` where id can be `ARXIV:{id}`, `DOI:{doi}`, or S2 paperId
- Batch lookup: `POST /paper/batch` with JSON body `{"ids": [...]}` (use Bash + curl for POST)
- Key fields to request: `paperId,title,authors,year,abstract,externalIds,citationCount,fieldsOfStudy,url,openAccessPdf`
- Rate limit: Shared unauthenticated pool; optional API key via `x-api-key` header
- Optional API key location: `SEMANTIC_SCHOLAR_API_KEY` env var or `.math/config.json` `semantic_scholar_api_key` field

**7. Query Construction Guidelines**
- Strip LaTeX notation from search terms (mathematical symbols don't work as API queries)
- Extract key mathematical nouns, theorem names, technique names from PROBLEM.md
- Use PROBLEM.md tags for concept keywords
- Use PROBLEM.md domain for arXiv category filtering
- Use PROBLEM.md known_results and references as query seeds
- Generate 3-5 distinct queries targeting different aspects of the problem
- Include a concrete URL example for arXiv and Semantic Scholar queries

**8. Incremental Search Rules**
- When LITERATURE.md already exists, read it first to avoid duplicate searches
- New searches complement prior results, they do not replace them
- Track all searches in the Search History table
- REF-NNN numbering continues from the last entry, never resets
- Deduplication: compare title + authors + year across arXiv and S2 results

**9. Journal Integration**
- After every completed search, the agent calls the session-manager agent to write a LIT- category journal entry
- Strategy type: `broad-survey` for initial/general searches, `targeted-search` for follow-up/specific searches
- Journal entry must include: query summary, result counts, confirmed/unconfirmed counts, key insight about the literature landscape

**10. Rate Limit Handling**
- arXiv: Use `id_list` for batch verification (one call instead of N)
- Semantic Scholar: Use individual GET requests for small batches (<10). For larger sets, use `POST /paper/batch` via Bash + curl
- Handle HTTP 429 gracefully: wait and retry once, then skip with note
- Design for 10-20 candidate papers per search, not 100

**Formatting notes:**
- Use the same structure and tone as `protocols/journal-protocol.md` and `protocols/confidence-tiers.md` for consistency
- Include concrete examples (URL templates, XML element paths, entry format) -- the agent needs specifics, not abstractions
  </action>
  <verify>
Read `protocols/literature-protocol.md` and confirm:
1. All 10 sections present
2. Two-phase workflow (A, B, C) defined with concrete steps
3. Anti-hallucination rules explicitly stated
4. LITERATURE.md schema with frontmatter fields and section structure defined
5. Domain-to-category mapping table with all 9 domains
6. Both API endpoints documented with URL templates
7. References to confidence-tiers.md and journal-protocol.md present
  </verify>
  <done>A comprehensive literature protocol exists at `protocols/literature-protocol.md` that defines the complete search-verify-synthesize workflow, anti-hallucination rules, LITERATURE.md schema, domain-to-category mapping, API references for both arXiv and Semantic Scholar, query construction guidelines, and journal integration rules.</done>
</task>

<task type="auto">
  <name>Task 2: Create LITERATURE.md template</name>
  <files>templates/LITERATURE.md</files>
  <action>
Create `templates/LITERATURE.md` -- the document template that gets populated in `.math/problems/{slug}/LITERATURE.md` when the literature search agent runs.

Use the exact schema from `protocols/literature-protocol.md` (created in Task 1) and 03-RESEARCH.md Pattern 3.

**Template content:**

YAML frontmatter:
```yaml
---
problem: "{PROBLEM_SLUG}"
total_papers: 0
confirmed_count: 0
unconfirmed_count: 0
last_search: ""
sources_queried: []
---
```

Body sections (in order):
1. `# Literature: {PROBLEM_TITLE}` -- main heading
2. `## Search History` -- table tracking all searches performed
   - Table columns: Date | Query Summary | arXiv Results | S2 Results | New Confirmed
   - Initially empty (just the header row)
3. `## Confirmed References` -- verified papers with full metadata
   - Initially: `(No confirmed references yet)`
4. `## Synthesis` -- connections between papers and the user's problem
   - Initially: `(No synthesis yet -- connections between papers and your problem will appear here after search)`
5. `## Unconfirmed References` -- papers that could not be verified
   - Initially: `(No unconfirmed references yet)`

**Consistency check:** Follow the same template style as `templates/PROBLEM.md`, `templates/DASHBOARD.md`, and `templates/JOURNAL.md` -- YAML frontmatter with placeholder values, markdown body with section headings and placeholder text.
  </action>
  <verify>
Read `templates/LITERATURE.md` and confirm:
1. YAML frontmatter with all 6 fields (problem, total_papers, confirmed_count, unconfirmed_count, last_search, sources_queried)
2. Four body sections present: Search History, Confirmed References, Synthesis, Unconfirmed References
3. Search History has table header row
4. Placeholder text in each section
  </verify>
  <done>A LITERATURE.md template exists at `templates/LITERATURE.md` with YAML frontmatter and four body sections matching the schema defined in the literature protocol.</done>
</task>

</tasks>

<verification>
1. `protocols/literature-protocol.md` exists and contains all 10 sections
2. `templates/LITERATURE.md` exists with proper frontmatter and body structure
3. Protocol references both `confidence-tiers.md` and `journal-protocol.md`
4. Template structure matches the schema defined in the protocol
5. No external dependencies introduced (all WebFetch + Write based)
</verification>

<success_criteria>
- Literature protocol defines complete search-verify-synthesize workflow usable by the agent in Plan 03-02
- LITERATURE.md template matches protocol schema and follows project template conventions
- Domain-to-arXiv-category mapping covers all 9 preset domains
- Anti-hallucination rules are explicit and enforceable
- API endpoints documented with concrete URL templates
</success_criteria>

<output>
After completion, create `.planning/phases/03-literature-search-agent/03-01-SUMMARY.md`
</output>
