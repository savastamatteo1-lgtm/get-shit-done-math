---
phase: 02-session-state-research-journal
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/config.json
  - templates/DASHBOARD.md
  - templates/JOURNAL.md
  - protocols/journal-protocol.md
autonomous: true

must_haves:
  truths:
    - "JOURNAL.md template defines categorized sections (Proof Attempts, Literature Searches, Computations, General Notes) with empty placeholders"
    - "DASHBOARD.md template defines structured overview sections with provenance tracking and suggested next action"
    - "config.json template supports multi-problem registry with current_problem pointer, problems array, and archived array"
    - "Journal protocol defines entry format with required insight/takeaway field, strategy type taxonomy, dead-end detection procedure, and frontmatter strategies_tried schema"
  artifacts:
    - path: "templates/config.json"
      provides: "Multi-problem config schema with problems array and current_problem pointer"
      contains: "current_problem"
    - path: "templates/DASHBOARD.md"
      provides: "Session restoration dashboard template with provenance tracking"
      contains: "Suggested Next Action"
    - path: "templates/JOURNAL.md"
      provides: "Research journal template with categorized sections and frontmatter strategies_tried"
      contains: "strategies_tried"
    - path: "protocols/journal-protocol.md"
      provides: "Journal writing protocol with entry format, strategy taxonomy, and dead-end detection"
      contains: "Dead-End Detection"
  key_links:
    - from: "protocols/journal-protocol.md"
      to: "templates/JOURNAL.md"
      via: "Protocol defines how agents write entries into the journal template"
      pattern: "JOURNAL\\.md"
    - from: "templates/DASHBOARD.md"
      to: "templates/JOURNAL.md"
      via: "Dashboard reads journal entries for Last Approach Tried section"
      pattern: "JOURNAL"
---

<objective>
Create the document schema foundation for Phase 2: updated config.json for multi-problem support, DASHBOARD.md template for session restoration, JOURNAL.md template for approach tracking, and a journal protocol defining entry format, strategy taxonomy, and dead-end detection.

Purpose: Every command and agent in Phase 2 depends on these schemas and protocols. They define the data model that /math:resume reads, /math:switch navigates, and all future agents write to.
Output: 4 files -- updated config.json template, DASHBOARD.md template, JOURNAL.md template, journal-protocol.md
</objective>

<execution_context>
@/Users/matteo/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matteo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-session-state-research-journal/02-CONTEXT.md
@.planning/phases/02-session-state-research-journal/02-RESEARCH.md

# Phase 1 patterns to follow:
@protocols/confidence-tiers.md
@templates/config.json
@templates/STATE.md
@templates/PROBLEM.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DASHBOARD.md, JOURNAL.md templates and update config.json</name>
  <files>
    templates/config.json
    templates/DASHBOARD.md
    templates/JOURNAL.md
  </files>
  <action>
**templates/config.json** -- Replace the existing Phase 1 config.json template with the Phase 2 multi-problem schema:

```json
{
  "version": "0.2.0",
  "current_problem": "",
  "problems": [],
  "archived": [],
  "plugin_version": "0.2.0"
}
```

Each entry in `problems` array will follow this shape (documented as a comment in the protocol, not in the template itself since JSON doesn't support comments):
```
{
  "slug": "",
  "title": "",
  "domain": "",
  "notation_preset": "",
  "created": "",
  "last_active": "",
  "state": "INITIALIZED"
}
```

The `archived` array holds the same shape but adds an `archived` timestamp field. The `current_problem` field stores the slug of the active problem. This replaces Phase 1's flat `domain`/`notation_preset`/`created` fields because that data now lives per-problem.

**templates/DASHBOARD.md** -- Create a new template file following the YAML-frontmatter + markdown-body pattern from Phase 1. Use the schema from 02-RESEARCH.md "DASHBOARD.md Template" section. The template must include:

Frontmatter fields:
- `generated`: placeholder for ISO timestamp
- `problem`: placeholder for problem slug
- `state`: placeholder for current state
- `session_number`: placeholder (0)

Body sections:
1. `# Research Dashboard: {PROBLEM_TITLE}` -- top heading
2. `## Problem` -- first 3-5 lines of PROBLEM.md body, truncated
3. `## Current State: {CURRENT_STATE}` -- with subsections:
   - `### Proof Progress` -- strategy, steps, gaps, confidence tiers, provenance line
   - `### Literature Found` -- paper count, key theorem, provenance line
   - `### Computations` -- summary, provenance line
   - `### Last Approach Tried` -- approach, outcome, journal entry reference
4. `## Suggested Next Action` -- context-specific suggestion placeholder

Each subsection must end with an italicized provenance line: `_Source: {agent}, {timestamp}_`

Use placeholder tokens like `{PROBLEM_TITLE}`, `{CURRENT_STATE}` etc. -- the /math:resume command will fill these when generating.

**templates/JOURNAL.md** -- Create a new template file. Use the schema from 02-RESEARCH.md "JOURNAL.md Template" section:

Frontmatter fields:
- `problem`: placeholder for problem slug
- `total_entries`: 0
- `last_entry`: ""
- `strategies_tried`: [] (empty array)

Body sections:
1. `# Research Journal: {PROBLEM_TITLE}` -- top heading
2. `## Proof Attempts` -- with "(No entries yet)" placeholder
3. `## Literature Searches` -- with "(No entries yet)" placeholder
4. `## Computations` -- with "(No entries yet)" placeholder
5. `## General Notes` -- with "(No entries yet)" placeholder

Each section will receive entries in the format defined by the journal protocol (Task 2).
  </action>
  <verify>
Verify all 3 files exist:
- `cat templates/config.json` -- must contain `current_problem`, `problems`, `archived` fields
- `cat templates/DASHBOARD.md` -- must have YAML frontmatter with `generated`, `problem`, `state`, `session_number` and body with `Suggested Next Action` section
- `cat templates/JOURNAL.md` -- must have YAML frontmatter with `strategies_tried` and body with 4 category sections
  </verify>
  <done>
config.json has multi-problem schema (current_problem + problems array + archived array). DASHBOARD.md has frontmatter + 4 main sections with provenance tracking + suggested next action. JOURNAL.md has frontmatter with strategies_tried + 4 categorized sections.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create journal protocol with entry format, strategy taxonomy, and dead-end detection</name>
  <files>
    protocols/journal-protocol.md
  </files>
  <action>
Create `protocols/journal-protocol.md` following the same pattern as `protocols/confidence-tiers.md` -- a shared protocol file that all agents load via @-reference.

The protocol must define these sections:

**1. Purpose** -- Brief statement: this protocol defines how agents write journal entries, what fields are required, and how dead-end detection works. All agents that perform significant research actions MUST follow this protocol.

**2. Journal Entry Format** -- The template for each entry. Use the format from 02-RESEARCH.md "Journal Entry Template":

```
### {CATEGORY}-{NNN}: {Title}
- **Timestamp:** {ISO_TIMESTAMP}
- **Agent:** {agent-name}
- **Strategy type:** {strategy_type}
- **Tags:** [{tag1}, {tag2}, {tag3}]
- **What was tried:** {description}
- **Outcome:** {SUCCEEDED | FAILED | PARTIAL | ABANDONED | IN_PROGRESS}
- **Reasoning:** {why this outcome}
- **Artifacts produced:** {files or "None"}
- **Related files:** {links}
- **Insight/Takeaway:** {REQUIRED -- what was learned}
```

Emphasize: **Insight/Takeaway is ALWAYS required, even for successes.** This is the core philosophy -- every research action teaches something.

**3. Entry Categories** -- Define the 4 category prefixes:
- `PROOF-{NNN}` -- Proof attempts, gap identifications, strategy changes
- `LIT-{NNN}` -- Literature searches, paper findings, synthesis
- `COMP-{NNN}` -- Computations, verifications, counterexample searches
- `NOTE-{NNN}` -- General observations, user notes, cross-problem insights

Numbers are sequential within each category (PROOF-001, PROOF-002, etc.).

**4. Frontmatter Update Protocol** -- When writing a journal entry, the agent MUST also update JOURNAL.md frontmatter:
- Increment `total_entries`
- Update `last_entry` to current timestamp
- For proof-related entries (PROOF- category): add/update entry in `strategies_tried` array with fields: `id`, `strategy`, `status`, `tags`

**5. Strategy Type Taxonomy** -- The full taxonomy from 02-RESEARCH.md (14 types):

| Strategy Type | Use For | Example |
|---|---|---|
| `direct` | Direct proof / construction | "Construct the inverse directly" |
| `contradiction` | Proof by contradiction | "Assume not invertible, derive contradiction" |
| `induction` | Any form of induction | "Induction on dimension n" |
| `contrapositive` | Proof by contrapositive | "Show if not B then not A" |
| `construction` | Explicit construction | "Construct a counterexample" |
| `estimation` | Bound/estimate argument | "Bound the operator norm" |
| `reduction` | Reduce to known result | "Reduce to finite-dimensional case" |
| `compactness` | Compactness argument | "Extract convergent subsequence" |
| `density` | Density/approximation | "Approximate by smooth functions" |
| `duality` | Duality argument | "Pass to dual space" |
| `computation` | Computational verification | "Compute for small cases" |
| `broad-survey` | Literature survey | "Search for related results" |
| `targeted-search` | Targeted literature search | "Find results on specific topic" |
| `gap-identification` | Identifying proof gaps | "Analyze where proof fails" |

**6. Dead-End Detection Protocol** -- The full detection flow from 02-RESEARCH.md "Dead-End Detection Integration" section. Include:

Before attempting a new proof strategy, the agent MUST:
1. Read JOURNAL.md frontmatter `strategies_tried` array
2. Compare proposed strategy type and tags against prior entries
3. Match criteria: same strategy type OR 2+ shared tags with any FAILED/ABANDONED entry
4. If match found:
   a. Read the matched entry's full body text
   b. Assess whether the current attempt is meaningfully different
   c. Check if conditions have changed (new literature, new lemmas, new computations)
   d. If conditions changed: suggest retrying with explanation of what's new
   e. If conditions unchanged: gentle nudge with prior attempt info, ask "Proceed anyway?"
5. If user proceeds after nudge: create journal entry noting intentional re-attempt with reference to prior entry
6. If no match: proceed normally

Include the exact message templates for both "conditions changed" and "conditions unchanged" nudges from the research doc.

**7. Outcome Values** -- Define the 5 valid outcome values:
- `SUCCEEDED` -- Goal fully achieved
- `FAILED` -- Goal not achieved, no path forward identified
- `PARTIAL` -- Some progress, but incomplete
- `ABANDONED` -- Deliberately stopped in favor of different approach
- `IN_PROGRESS` -- Currently active, not yet resolved

**8. Writing Guidelines** -- Brief rules for agents:
- Write entries at "significant action" granularity (not every micro-step)
- Use specific, descriptive titles (not "Attempted proof" but "Contradiction via non-invertibility")
- Tags should be mathematical concepts and techniques, 3-5 per entry
- Related files use markdown links relative to the problem directory
- Insight/Takeaway should be 1-3 sentences capturing the key learning
  </action>
  <verify>
Verify protocol file:
- `cat protocols/journal-protocol.md` -- must contain all 8 sections
- Grep for "Insight/Takeaway" to confirm it appears as required field
- Grep for "Dead-End Detection" to confirm detection protocol exists
- Grep for strategy type taxonomy (should have all 14 types)
- Grep for "strategies_tried" to confirm frontmatter update protocol
  </verify>
  <done>
Journal protocol defines entry format with required insight/takeaway field, 4 entry categories with sequential numbering, frontmatter update rules, 14-type strategy taxonomy, complete dead-end detection flow with gentle nudge messages, 5 outcome values, and agent writing guidelines. File follows the same pattern as confidence-tiers.md for @-reference loading by all future agents.
  </done>
</task>

</tasks>

<verification>
1. `templates/config.json` parses as valid JSON with `current_problem`, `problems`, and `archived` fields
2. `templates/DASHBOARD.md` has valid YAML frontmatter and contains sections: Problem, Current State (with Proof Progress, Literature Found, Computations, Last Approach Tried subsections), Suggested Next Action
3. `templates/JOURNAL.md` has valid YAML frontmatter with `strategies_tried: []` and contains sections: Proof Attempts, Literature Searches, Computations, General Notes
4. `protocols/journal-protocol.md` contains: entry format template, 4 category definitions, frontmatter update protocol, 14-type strategy taxonomy, dead-end detection flow, 5 outcome values, writing guidelines
5. All files follow YAML-frontmatter + markdown-body pattern established in Phase 1
</verification>

<success_criteria>
- 3 template files and 1 protocol file exist with complete schemas
- Journal protocol is loadable via @-reference (same pattern as confidence-tiers.md)
- Dead-end detection protocol includes strategy matching criteria and both nudge message templates
- Every required field from user decisions (provenance tracking, insight/takeaway, categorized sections, strategy-level matching) is present in the appropriate template or protocol
</success_criteria>

<output>
After completion, create `.planning/phases/02-session-state-research-journal/02-01-SUMMARY.md`
</output>
